{% extends "tracking/base.html" %}
{% block title %}{{ project.title }} – Boss{% endblock %}
{% block content %}
<div class="page-header">
  <a href="{% url 'all_projects' %}" class="back-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 5l-7 7 7 7"/></svg></a>
  <div>
    <div class="page-title">{{ project.title }}</div>
    <div class="page-subtitle">{{ project.company }}</div>
  </div>
</div>
<div class="card" style="margin-bottom:20px;">
  <div class="info-grid">
    <div><div class="info-key">Cég</div><div class="info-value">{{ project.company }}</div></div>
    <div><div class="info-key">Helyszín</div><div class="info-value">{{ project.location|default:"–" }}</div></div>
    <div><div class="info-key">Típus</div><div class="info-value">
      {% if project.project_type == "video" %}<span class="badge badge-blue">Videós</span>
      {% elif project.project_type == "photo" %}<span class="badge badge-orange">Fotós</span>
      {% else %}<span class="badge badge-purple">Mindkettő</span>{% endif %}
    </div></div>
    <div><div class="info-key">Főhatáridő</div><div class="info-value">{{ project.main_deadline|default:"–" }}</div></div>
    <div><div class="info-key">Bevétel</div><div class="info-value">{{ project.revenue }} Ft</div></div>
    <div><div class="info-key">Státusz</div><div class="info-value">
      {% if project.is_completed %}<span class="badge badge-green">Kész</span>
      {% elif project.is_expired %}<span class="badge badge-gray">Lejárt</span>
      {% else %}<span class="badge badge-blue">Aktív</span>{% endif %}
    </div></div>
  </div>
  {% if project.description %}<p style="font-size:0.9rem;color:var(--text-secondary);margin-top:12px;">{{ project.description }}</p>{% endif %}
</div>
{% if not project.is_completed and not project.is_expired %}
<div style="margin-bottom:20px;">
  <form method="post">{% csrf_token %}
    <button type="submit" name="complete_project" class="btn btn-danger" onclick="return confirm('Biztosan lezárod a projektet?')">Projekt lezárása</button>
  </form>
</div>
{% endif %}
{% for role, members in members_by_role.items %}
<div class="section-header"><span class="section-title">{{ role }}</span></div>
{% for member in members %}
<div class="card" style="margin-bottom:12px;">
  <div class="card-header">
    <div>
      <a href="{% url 'employee_detail' member.user.pk %}" style="color:var(--accent-blue);font-weight:600;text-decoration:none;">{{ member.user.get_full_name|default:member.user.username }}</a>
    </div>
    <span style="color:var(--accent-blue);font-weight:700;">{{ member.total_hours }} h</span>
  </div>
  {% for log in member.logs %}
  <a href="{% url 'employee_log_view' member.user.pk project.pk log.pk %}" class="log-item">
    <div>
      <div class="log-date">{{ log.date|date:"Y. m. d. H:i" }}</div>
      {% if log.comment %}<div class="log-comment">{{ log.comment }}</div>{% endif %}
    </div>
    <div class="log-hours">{{ log.hours }} h</div>
  </a>
  {% empty %}<p style="font-size:0.85rem;color:var(--text-muted);padding:8px 0;">Nincs log</p>{% endfor %}
</div>
{% endfor %}
{% empty %}<div class="empty-state"><p>Nincsenek hozzárendelt dolgozók</p></div>{% endfor %}
{% endblock %}
