{% extends "tracking/base.html" %}
{% block title %}Kiadások – Tracker{% endblock %}
{% block content %}
<div style="display: flex; gap: 20px; align-items: flex-start;">
  <!-- Oldalsó Panel - Hónapokra lebontott profit -->
  <div style="width: 280px; flex-shrink: 0;">
    <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; position: sticky; top: 80px;">
      <div style="font-size: 0.8rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 12px;">{{ year }}. Év</div>
      <div class="monthly-list">
        {% for data in monthly_profits %}
        <a href="?month={{ data.month }}&year={{ year }}" class="monthly-item {% if data.month == month %}active{% endif %}" style="{% if data.month == month %}background: var(--bg-hover); border-color: var(--accent-blue);{% endif %}">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
            <span style="font-size: 0.85rem; font-weight: 600;">{{ data.month_name }}</span>
            <span style="font-size: 0.75rem; color: var(--text-muted);">{{ data.month }}.</span>
          </div>
          <div style="display: flex; justify-content: space-between; gap: 8px; margin-bottom: 4px; font-size: 0.75rem;">
            <span style="color: var(--text-secondary);">Bevétel</span>
            <span style="color: var(--accent-blue); font-weight: 600;">{{ data.revenue }} Ft</span>
          </div>
          <div style="display: flex; justify-content: space-between; gap: 8px; margin-bottom: 4px; font-size: 0.75rem;">
            <span style="color: var(--text-secondary);">Kiadás</span>
            <span style="color: var(--accent-red); font-weight: 600;">{{ data.expenses }} Ft</span>
          </div>
          <div style="display: flex; justify-content: space-between; gap: 8px; padding-top: 4px; border-top: 1px solid var(--border-subtle); font-size: 0.75rem; font-weight: 600;">
            <span style="color: var(--text-secondary);">Profit</span>
            <span style="color: {% if data.profit >= 0 %}var(--accent-green){% else %}var(--accent-red){% endif %};">{{ data.profit }} Ft</span>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Fő tartalom -->
  <div style="flex: 1;">
    <div class="page-header">
      <a href="{% url 'boss_dashboard' %}" class="back-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 5l-7 7 7 7"/></svg></a>
      <div>
        <div class="page-title">Kiadások és Profit</div>
        <div class="page-subtitle">{{ month_name }} {{ year }}</div>
      </div>
    </div>

    <div class="grid-2" style="margin-bottom:20px;">
      <div class="card" style="background: linear-gradient(135deg, rgba(88,166,255,0.1), rgba(88,166,255,0.05)); border-left: 4px solid #58A6FF;">
        <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 4px;">Havi bevétel</div>
        <div style="font-size: 1.5rem; font-weight: 600; color: #58A6FF;">{{ monthly_revenue|floatformat:0 }} Ft</div>
        <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 4px;">{{ month_name }}-ban</div>
      </div>
      <div class="card" style="background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(76,175,80,0.05)); border-left: 4px solid #4CAF50;">
        <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 4px;">Havi profit</div>
        <div style="font-size: 1.5rem; font-weight: 600; color: {% if monthly_profit >= 0 %}#4CAF50{% else %}#ff3b30{% endif %};">{{ monthly_profit|floatformat:0 }} Ft</div>
        <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 4px;">Bevétel - Kiadások</div>
      </div>
    </div>

    <div class="card">
      <div class="card-header"><span class="card-title">Új Kiadás</span></div>
      <form method="post">
        {% csrf_token %}
        <div class="form-group">
          <label class="form-label">{{ form.amount.label }}</label>
          {{ form.amount }}
          {% if form.amount.errors %}<span class="form-error">{{ form.amount.errors.0 }}</span>{% endif %}
        </div>
        <div class="form-group">
          <label class="form-label">{{ form.description.label }}</label>
          {{ form.description }}
          {% if form.description.errors %}<span class="form-error">{{ form.description.errors.0 }}</span>{% endif %}
        </div>
        <button type="submit" class="btn btn-primary">Hozzáadás</button>
      </form>
    </div>

    {% if expenses %}
    <div class="section-header" style="margin-top:32px;"><span class="section-title">Kiadások Ebben a Hónapban</span></div>
    <div class="table-wrap">
      <table class="data-table">
        <thead><tr><th>Dátum</th><th>Leírás</th><th>Összeg</th><th>Felvevő</th><th>Műveletek</th></tr></thead>
        <tbody>
          {% for expense in expenses %}
          <tr>
            <td>{{ expense.date|date:"Y. m. d." }}</td>
            <td>{{ expense.description }}</td>
            <td style="text-align: right;">{{ expense.amount }} Ft</td>
            <td>{{ expense.created_by.get_full_name|default:expense.created_by.username }}</td>
            <td>
              <a href="{% url 'delete_expense' expense.pk %}?month={{ month }}&year={{ year }}" class="btn btn-sm btn-danger">Törlés</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state" style="margin-top:32px;">
      <p>Nincsenek kiadások ebben a hónapban</p>
    </div>
    {% endif %}
  </div>
</div>

<style>
.monthly-item {
  display: block;
  padding: 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  text-decoration: none;
  color: inherit;
  transition: var(--transition);
  cursor: pointer;
}

.monthly-item:hover {
  border-color: var(--accent-blue);
  background: var(--bg-hover);
}

.monthly-item.active {
  border-color: var(--accent-blue);
  background: var(--bg-hover);
}

.monthly-list {
  max-height: calc(100vh - 250px);
  overflow-y: auto;
}

@media (max-width: 1000px) {
  .monthly-list {
    max-height: 100%;
  }
  
  /* Pequeño cambio para display flex cuando hay poco espacio */
  div[style*="display: flex"] > div:first-child {
    width: auto !important;
    position: static !important;
  }
}
</style>
{% endblock %}
